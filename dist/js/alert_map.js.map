{"version":3,"file":"alert_map.js","names":["genMap","origin","destinations","mapboxAccessToken","profile_name","hq","mapBox","document","getElementById","mapDiv","removeChild","newMapDiv","createElement","id","appendChild","mapboxgl","accessToken","map","Map","container","style","center","zoom","scrollZoom","updateMap","newDestinations","console","log","remove","pitch","bearing","antialias","on","addControl","NavigationControl","marker_origin","Marker","element","createCustomMarkerElementForOrigin","anchor","setLngLat","addTo","originCustomPopup","Popup","offset","setDOMContent","createCustomPopupContentForOrigin","setPopup","getElement","addEventListener","togglePopup","forEach","destination","index","apiUrl","coordinates","fetch","then","response","ok","Error","json","data","addSource","type","routes","geometry","addLayer","source","layout","paint","color","catch","error","marker_destination","createCustomMarkerElementForDestination","destinationCustomPopup","createCustomPopupContentForDestination","properties","name","setAttribute","destinationInfo","querySelector","textContent","headerTogglers","getElementsByClassName","sidebarTogglers","i","length","setTimeout","resize","customMarker","className","backgroundImage","width","height","backgroundSize","popupContainer","popupContent"],"sources":["../../src/js/alert_map.js"],"sourcesContent":["function genMap(origin, destinations, mapboxAccessToken, profile_name, hq) {\r\n\r\n    // Find the parent element with id \"map-box\"\r\n    const mapBox = document.getElementById('map-box');\r\n\r\n    // Check if the map div already exists\r\n    const mapDiv = document.getElementById('map');\r\n\r\n    if (mapDiv) {\r\n    // If it exists, remove it\r\n    mapBox.removeChild(mapDiv);\r\n    } \r\n\r\n    // If it doesn't exist, create and append the new div\r\n    const newMapDiv = document.createElement('div');\r\n    newMapDiv.id = 'map'; // Set the id attribute\r\n    mapBox.appendChild(newMapDiv);\r\n\r\n    // Initialize the map\r\n    mapboxgl.accessToken = mapboxAccessToken;\r\n    let map = new mapboxgl.Map({\r\n      container: 'map',\r\n      // Specify the ID of the container element\r\n      style: 'mapbox://styles/mapbox/streets-v11',\r\n      // Map style\r\n      center: origin,\r\n      // Initial map center\r\n      zoom: 16,\r\n      // Initial zoom level\r\n      scrollZoom: false // Disable zooming with the mouse scroll wheel\r\n    });\r\n  \r\n    // Create a function to update the map with new destinations\r\n    function updateMap(newDestinations) {\r\n      console.log(newDestinations);\r\n      // Remove existing markers and routes\r\n      map.remove();\r\n  \r\n      // Recreate the map\r\n      map = new mapboxgl.Map({\r\n        container: 'map',\r\n        style: 'mapbox://styles/mapbox/streets-v11',\r\n        center: origin,\r\n        zoom: 16,\r\n        pitch: 45,\r\n        bearing: -17.6,\r\n        container: 'map',\r\n        antialias: true,\r\n        scrollZoom: false\r\n      });\r\n      map.on('style.load', function () {\r\n        // Add a navigation control (optional)\r\n        map.addControl(new mapboxgl.NavigationControl());\r\n  \r\n        // Create a marker for the origin and name it marker_origin\r\n        const marker_origin = new mapboxgl.Marker({\r\n          element: createCustomMarkerElementForOrigin(),\r\n          anchor: 'bottom'\r\n        })\r\n          .setLngLat(origin)\r\n          .addTo(map);\r\n\r\n        // Create a origin custom popup\r\n        const originCustomPopup = new mapboxgl.Popup({ offset: 30 })\r\n          .setDOMContent(createCustomPopupContentForOrigin());\r\n\r\n        // Set the popup for the marker\r\n        marker_origin.setPopup(originCustomPopup);\r\n\r\n        // Show the popup on marker hover\r\n        marker_origin.getElement().addEventListener('mouseenter', () => {\r\n          marker_origin.togglePopup();\r\n        });\r\n\r\n        // Remove the popup on marker mouseleave\r\n        marker_origin.getElement().addEventListener('mouseleave', () => {\r\n          marker_origin.togglePopup();\r\n        });\r\n\r\n  \r\n        // Loop through the new destinations and calculate routes\r\n        newDestinations.forEach((destination, index) => {\r\n          // Use the Mapbox Directions API to calculate and display the route\r\n          const apiUrl = `https://api.mapbox.com/directions/v5/mapbox/driving/${origin[0]},${origin[1]};${destination.coordinates[0]},${destination.coordinates[1]}?alternatives=true&geometries=geojson&language=en&overview=full&steps=true&access_token=${mapboxAccessToken}`;\r\n          fetch(apiUrl).then(response => {\r\n            if (!response.ok) {\r\n              throw new Error('Network response was not ok');\r\n            }\r\n            return response.json();\r\n          }).then(data => {\r\n            // Add the route to the map with the specified color\r\n            map.addSource(`route-${index}`, {\r\n              type: 'geojson',\r\n              data: data.routes[0].geometry\r\n            });\r\n            map.addLayer({\r\n              id: `route-${index}`,\r\n              type: 'line',\r\n              source: `route-${index}`,\r\n              layout: {\r\n                'line-join': 'round',\r\n                'line-cap': 'round'\r\n              },\r\n              paint: {\r\n                'line-color': destination.color,\r\n                // Use the specified color for each route\r\n                'line-width': 5\r\n              }\r\n            });\r\n          }).catch(error => {\r\n            console.error('There was a problem with the fetch operation:', error);\r\n          });\r\n  \r\n          // Create a marker for the destination and name it marker_destination\r\n          const marker_destination = new mapboxgl.Marker({\r\n            element: createCustomMarkerElementForDestination(index),\r\n            anchor: 'bottom'\r\n          })\r\n            .setLngLat(destination.coordinates)\r\n            .addTo(map);\r\n\r\n          // Create a custom popup\r\n          const destinationCustomPopup = new mapboxgl.Popup({ offset: 30 })\r\n            .setDOMContent(createCustomPopupContentForDestination(index));\r\n\r\n          // Set the popup for the marker\r\n          marker_destination.setPopup(destinationCustomPopup);\r\n\r\n          // Show the popup on marker hover\r\n          marker_destination.getElement().addEventListener('mouseenter', () => {\r\n            destinationCustomPopup.addTo(map);\r\n          });\r\n\r\n          // Remove the popup on marker mouseleave\r\n          marker_destination.getElement().addEventListener('mouseleave', () => {\r\n            destinationCustomPopup.remove();\r\n          });\r\n\r\n          // Store the destination information as a property of the marker\r\n          marker_destination.properties = {\r\n            name: `Destination ${index + 1}`,\r\n            // Add other properties as needed\r\n          };\r\n\r\n          // Add data-coreui-toggle and data-coreui-target attributes to the marker element\r\n          marker_destination.getElement().setAttribute('data-coreui-toggle', 'modal');\r\n          marker_destination.getElement().setAttribute('data-coreui-target', '#show_accident_incident_area');\r\n\r\n          // Show the custom popup on marker click\r\n          marker_destination.getElement().addEventListener('click', () => {\r\n            // Retrieve the destination information from the marker's properties\r\n            const destinationInfo = marker_destination.properties;\r\n\r\n            // Populate the modal content with the destination name\r\n            document.querySelector('#show_accident_incident_area .modal-body').textContent = destinationInfo.name;\r\n\r\n          });\r\n\r\n        });\r\n      });\r\n    }\r\n  \r\n    // Call the updateMap function with the initial destinations\r\n    updateMap(destinations);\r\n  \r\n    // Get elements by class name\r\n    const headerTogglers = document.getElementsByClassName(\"header-toggler\");\r\n    const sidebarTogglers = document.getElementsByClassName(\"sidebar-toggler\");\r\n  \r\n    // Loop through the elements and add event listener\r\n    for (let i = 0; i < headerTogglers.length; i++) {\r\n      headerTogglers[i].addEventListener(\"click\", function () {\r\n        // Trigger a map resize event when the sidebar state changes\r\n        setTimeout(() => {\r\n          map.resize();\r\n        }, 300);\r\n      });\r\n    }\r\n    for (let i = 0; i < sidebarTogglers.length; i++) {\r\n      sidebarTogglers[i].addEventListener(\"click\", function () {\r\n        // Trigger a map resize event when the sidebar state changes\r\n        setTimeout(() => {\r\n          map.resize();\r\n        }, 300);\r\n      });\r\n    }\r\n  \r\n    // Function to create a custom marker element for destination\r\n    function createCustomMarkerElementForDestination(index) {\r\n      const customMarker = document.createElement('div');\r\n      customMarker.className = 'custom-marker';\r\n      customMarker.style.backgroundImage = `url('../assets/brand/alert.png')`; // Adjust the path accordingly\r\n      customMarker.style.width = '50px'; // Adjust the width and height of your custom marker\r\n      customMarker.style.height = '50px';\r\n      customMarker.style.backgroundSize = 'cover'; // Set the background size to cover\r\n      return customMarker;\r\n    }\r\n    \r\n  \r\n    // Function to create a custom marker element for the origin\r\n    function createCustomMarkerElementForOrigin() {\r\n      const customMarker = document.createElement('div');\r\n      customMarker.className = 'custom-marker';\r\n      customMarker.style.backgroundImage = 'url(\"../assets/brand/police.png\")'; // Specify the path to your custom origin marker image\r\n      customMarker.style.width = '70px'; // Adjust the width and height as needed\r\n      customMarker.style.height = '70px';\r\n      customMarker.style.backgroundSize = 'cover'; // Maintain the image aspect ratio\r\n  \r\n      return customMarker;\r\n    }\r\n\r\n    //customPopup for origin\r\n    function createCustomPopupContentForOrigin() {\r\n      // Create a container element for the popup\r\n      const popupContainer = document.createElement('div');\r\n      popupContainer.className = 'custom-popup';\r\n    \r\n      // Add your custom content to the popup\r\n      const popupContent = document.createElement('div');\r\n      popupContent.textContent = profile_name + ' station '+ hq + ' headquarter.' ;\r\n    \r\n      // Append the content to the container\r\n      popupContainer.appendChild(popupContent);\r\n    \r\n      return popupContainer;\r\n    }\r\n\r\n    function createCustomPopupContentForDestination(index) {\r\n      // Create a container element for the popup\r\n      const popupContainer = document.createElement('div');\r\n      popupContainer.className = 'custom-popup';\r\n    \r\n      // Add your custom content to the popup\r\n      const popupContent = document.createElement('div');\r\n      popupContent.textContent = `Destination ${index + 1}`;\r\n    \r\n      // Append the content to the container\r\n      popupContainer.appendChild(popupContent);\r\n    \r\n      return popupContainer;\r\n    }\r\n    \r\n  }\r\n  //# sourceMappingURL=alert_map.js.map"],"mappings":"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"}